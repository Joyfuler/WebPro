--테이블삭제

DROP SEQUENCE ORDERDETAIL_SEQ;
DROP TABLE ORDERDETAIL;
DROP TABLE CART;
DROP SEQUENCE CART_SEQ;
DROP TABLE ORDERS;
DROP SEQUENCE ORDERS_SEQ;
DROP TABLE PRODUCT;
DROP TABLE MEMBER;

--테이블생성

CREATE TABLE MEMBER (
MID VARCHAR2(15) PRIMARY KEY,
MNAME VARCHAR2(20) NOT NULL,
MTEL VARCHAR2(20) NOT NULL UNIQUE,
MADDR VARCHAR2(255),
MEMAIL VARCHAR2(120)
);

CREATE TABLE PRODUCT (
PCODE VARCHAR2(10) PRIMARY KEY,
PNAME VARCHAR2(255) NOT NULL,
PRICE NUMBER(10) NOT NULL
);

CREATE TABLE CART (
CARTIDX NUMBER(4) PRIMARY KEY,
MID VARCHAR2 (15),
PCODE VARCHAR2(10),
QTY NUMBER(3) NOT NULL,
PRICE NUMBER(8) NOT NULL,
FOREIGN KEY (MID) REFERENCES MEMBER (MID),
FOREIGN KEY (PCODE) REFERENCES PRODUCT (PCODE)
);

CREATE TABLE ORDERS (
ONO VARCHAR2(20) PRIMARY KEY,
MID VARCHAR2(15),
ONAME VARCHAR2(20),
OADDR VARCHAR2(255),
OTEL VARCHAR2(20),
ODATE DATE DEFAULT SYSDATE,
FOREIGN KEY (MID) REFERENCES MEMBER (MID)
);

CREATE TABLE ORDERDETAIL (
ODIDX NUMBER(4) PRIMARY KEY,
ONO VARCHAR2(20),
PCODE VARCHAR2(10),
ODQTY NUMBER(3) NOT NULL,
ODCOST NUMBER(8),
FOREIGN KEY (ONO) REFERENCES ORDERS (ONO),
FOREIGN KEY (PCODE) REFERENCES PRODUCT (PCODE)
);

-- MEMBER테이블데이터삽입
INSERT INTO MEMBER VALUES ('abc', '홍길동', '010-9999-9999', '서울시 서대문구 대현동', 'honggildong@google.com');
INSERT INTO MEMBER VALUES ('def', '김길동', '010-8888-8888', '경기도 수원시', 'kimkildong@google.com');

-- PRODUCT테이블데이터삽입
INSERT INTO PRODUCT VALUES ('A1', '맥주', 3000);
INSERT INTO PRODUCT VALUES ('A2', '마스크', 200);
INSERT INTO PRODUCT VALUES ('B1', '땅콩', 3000);
INSERT INTO PRODUCT VALUES ('B2', '오징어', 5000);
INSERT INTO PRODUCT VALUES ('C1', '소독약', 7000);
SELECT * FROM PRODUCT;


-- CART테이블데이터 삽입

CREATE SEQUENCE CART_SEQ START WITH 1 MAXVALUE 99999 NOCACHE NOCYCLE;
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'abc', 'A1', 3, (SELECT PRICE FROM PRODUCT WHERE PCODE='A1')*3);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'abc', 'B1', 1, (SELECT PRICE FROM PRODUCT WHERE PCODE='B1')*1);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'def', 'A2', 20, (SELECT PRICE FROM PRODUCT WHERE PCODE='A2')*20);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'def', 'B2', 2, (SELECT PRICE FROM PRODUCT WHERE PCODE='B2')*2);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'def', 'C1', 1, (SELECT PRICE FROM PRODUCT WHERE PCODE='C1')*1);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'abc', 'A1', 2, (SELECT PRICE FROM PRODUCT WHERE PCODE='A1')*2);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'abc', 'B1', 1, (SELECT PRICE FROM PRODUCT WHERE PCODE='B1')*1);
INSERT INTO CART VALUES (CART_SEQ.NEXTVAL, 'abc', 'C1', 1, (SELECT PRICE FROM PRODUCT WHERE PCODE='C1')*1);

SELECT * FROM CART;

-- ORDERS테이블데이터 삽입
CREATE SEQUENCE ORDERS_SEQ START WITH 1 MAXVALUE 9999 NOCACHE NOCYCLE;
INSERT INTO ORDERS (ONO,MID,ONAME,OADDR,OTEL) VALUES (TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.NEXTVAL,'000')),'abc','홍길동', '서울시 서대문구 대현동','010-9999-9999');
INSERT INTO ORDERS (ONO,MID,ONAME,OADDR,OTEL) VALUES (TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.NEXTVAL,'000')),'def','김길동', '경기도 수원시','010-8888-8888');
INSERT INTO ORDERS (ONO,MID,ONAME,OADDR,OTEL) VALUES (TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.NEXTVAL,'000')),'abc','홍아빠', '제주도 제주시','010-7777-9999');
SELECT * FROM ORDERS;

-- ORDERDETAIL테이블데이터 삽입
CREATE SEQUENCE ORDERDETAIL_SEQ START WITH 1 MAXVALUE 99999 NOCACHE NOCYCLE;
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'A1',3, (SELECT PRICE FROM PRODUCT WHERE PCODE='A1')*3);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'B1',1, (SELECT PRICE FROM PRODUCT WHERE PCODE='B1')*1);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'A2',20, (SELECT PRICE FROM PRODUCT WHERE PCODE='A2')*20);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'B2',2, (SELECT PRICE FROM PRODUCT WHERE PCODE='B2')*2);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'C1',1, (SELECT PRICE FROM PRODUCT WHERE PCODE='C1')*1);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'A1',2, (SELECT PRICE FROM PRODUCT WHERE PCODE='A1')*2);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'B1',1, (SELECT PRICE FROM PRODUCT WHERE PCODE='B1')*1);
INSERT INTO ORDERDETAIL VALUES (ORDERDETAIL_SEQ.NEXTVAL, TO_CHAR(SYSDATE,'YYYYMMDD')||TRIM(TO_CHAR(ORDERS_SEQ.CURRVAL,'000')),'C1',1, (SELECT PRICE FROM PRODUCT WHERE PCODE='C1')*1);

SELECT ODIDX, O.ONO, O.ONAME, O.OADDR, O.OTEL, O.ODATE, OD.PCODE, P.PNAME, P.PRICE, ODQTY, ODCOST FROM ORDERDETAIL OD, PRODUCT P, ORDERS O
WHERE OD.PCODE=P.PCODE AND O.ONO = OD.ONO ORDER BY ODIDX;
